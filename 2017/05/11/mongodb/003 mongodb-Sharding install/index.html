<!DOCTYPE html><html lang="[&quot;zh-CN&quot;,&quot;en&quot;,&quot;default&quot;]"><head><meta name="generator" content="Hexo 3.9.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="姚杰的博客"><title>003 mongodb集群方式Sharding的搭建 | 雨中风筝</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.3.1/jquery.min.js"></script><link rel="icon" mask sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><link rel="alternate" type="application/atom+xml" href="/atom.xml"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">003 mongodb集群方式Sharding的搭建</h1><a id="logo" href="/.">雨中风筝</a><p class="description">雨，淅淅沥沥的下；风筝，摇曳穿梭</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a><a href="/atom.xml"><i class="fa fa-rss"> 订阅</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">003 mongodb集群方式Sharding的搭建</h1><div class="post-meta">May 11, 2017<span> | </span><span class="category"><a href="/categories/mongodb/">mongodb</a></span></div><div class="post-content"><h3 id="Sharding"><a href="#Sharding" class="headerlink" title="Sharding"></a>Sharding</h3><p>参考：<a href="http://www.cnblogs.com/zhaowenzhong/p/5163861.html" target="_blank" rel="noopener">http://www.cnblogs.com/zhaowenzhong/p/5163861.html</a></p>
<p>和Replica Set类似，都需要一个仲裁节点，但是Sharding还需要配置节点和路由节点。就三种集群搭建方式来说，这种是最复杂的。部署图如下：</p>
<p><img src="/images/mongodb/Sharding.png" width="50%" height="50%"></p>
<p>1.启动数据节点</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./mongod</span> <span class="params">--fork</span> <span class="params">--dbpath</span> <span class="string">../data/set1/</span> <span class="params">--logpath</span> <span class="string">../log/set1.log</span> <span class="params">--replSet</span> test <span class="comment">#192.168.4.43  </span></span><br><span class="line"><span class="string">./mongod</span> <span class="params">--fork</span> <span class="params">--dbpath</span> <span class="string">../data/set2/</span> <span class="params">--logpath</span> <span class="string">../log/set2.log</span> <span class="params">--replSet</span> test <span class="comment">#192.168.4.44  </span></span><br><span class="line"><span class="string">./mongod</span> <span class="params">--fork</span> <span class="params">--dbpath</span> <span class="string">../data/set3/</span> <span class="params">--logpath</span> <span class="string">../log/set3.log</span> <span class="params">--replSet</span> test <span class="comment">#192.168.4.45 决策 不存储数据</span></span><br></pre></td></tr></table></figure>
<p>2.启动配置节点</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./mongod</span> <span class="params">--configsvr</span> <span class="params">--dbpath</span> <span class="string">../config/set1/</span> <span class="params">--port</span> 20001 <span class="params">--fork</span> <span class="params">--logpath</span> <span class="string">../log/conf1.log</span> <span class="comment">#192.168.4.30  </span></span><br><span class="line"><span class="string">./mongod</span> <span class="params">--configsvr</span> <span class="params">--dbpath</span> <span class="string">../config/set2/</span> <span class="params">--port</span> 20002 <span class="params">--fork</span> <span class="params">--logpath</span> <span class="string">../log/conf2.log</span> <span class="comment">#192.168.4.31</span></span><br></pre></td></tr></table></figure>
<p>3.启动路由节点</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">./mongos</span> <span class="params">--configdb</span> 192.168.4.30<span class="function">:20001</span>,192.168.4.31<span class="function">:20002</span> <span class="params">--port</span> 27017 <span class="params">--fork</span> <span class="params">--logpath</span> <span class="string">../log/root.log</span> <span class="comment">#192.168.4.29</span></span><br></pre></td></tr></table></figure>
<p>这里我们没有用配置文件的方式启动，其中的参数意义大家应该都明白。一般来说一个数据节点对应一个配置节点，仲裁节点则不需要对应的配置节点。注意在启动路由节点时，要将配置节点地址写入到启动命令里。</p>
<p>4.配置Replica Set</p>
<p>这里可能会有点奇怪为什么Sharding会需要配置Replica Set。其实想想也能明白，多个节点的数据肯定是相关联的，如果不配一个Replica Set，怎么标识是同一个集群的呢。这也是人家mongodb的规定，咱们还是遵守吧。配置方式和之前所说的一样，定一个cfg，然后初始化配置。</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">./mongo <span class="number">192.168</span>.<span class="number">4.43</span>:<span class="number">27017</span>   <span class="meta">#ip和port是某个节点的地址  </span></span><br><span class="line">&gt;use admin  </span><br><span class="line">&gt;cfg=&#123; _id:<span class="string">"testrs"</span>, members:[ &#123;_id:<span class="number">0</span>,host:'192.168.4.43:<span class="number">2701</span>7',priority:<span class="number">2</span>&#125;, &#123;_id:<span class="number">1</span>,host:'192.168.4.44:<span class="number">2701</span>7',priority:<span class="number">1</span>&#125;,   </span><br><span class="line">&#123;_id:<span class="number">2</span>,host:'192.168.4.45:<span class="number">2701</span>7',arbiterOnly:true&#125;] &#125;;  </span><br><span class="line">&gt;rs.initiate(cfg)             <span class="meta">#使配置生效</span></span><br></pre></td></tr></table></figure>
<p>5.配置Sharding</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">./<span class="selector-tag">mongo</span> <span class="selector-tag">192</span><span class="selector-class">.168</span><span class="selector-class">.4</span><span class="selector-class">.29</span><span class="selector-pseudo">:27017</span>   #这里必须连接路由节点  </span><br><span class="line">&gt;<span class="selector-tag">sh</span><span class="selector-class">.addShard</span>(<span class="string">"test/192.168.4.43:27017"</span>) <span class="selector-id">#test</span>表示<span class="selector-tag">replica</span> <span class="selector-tag">set</span>的名字 当把主节点添加到<span class="selector-tag">shard</span>以后，会自动找到<span class="selector-tag">set</span>里的主，备，决策节点  </span><br><span class="line">&gt;<span class="selector-tag">db</span><span class="selector-class">.runCommand</span>(&#123;<span class="attribute">enableSharding</span>:<span class="string">"diameter_test"</span>&#125;)    <span class="selector-id">#diameter_test</span> <span class="selector-tag">is</span> <span class="selector-tag">database</span> <span class="selector-tag">name</span>  </span><br><span class="line">&gt;<span class="selector-tag">db</span><span class="selector-class">.runCommand</span>( &#123; <span class="attribute">shardCollection</span>: <span class="string">"diameter_test.dcca_dccr_test"</span>,<span class="attribute">key</span>:&#123;<span class="string">"__avpSessionId"</span>:<span class="number">1</span>&#125;&#125;)</span><br></pre></td></tr></table></figure>
<p>第一个命令很容易理解，第二个命令是对需要进行Sharding的数据库进行配置，第三个命令是对需要进行Sharding的Collection进行配置，这里的dcca_dccr_test即为Collection的名字。另外还有个key，这个是比较关键的东西，对于查询效率会有很大的影响，具体可以查看Shard Key Overview</p>
<p>6.后期：添加多个分片</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">登录mongs 添加分片服务器：</span><br><span class="line">./mongo 127.0.0.1:27019</span><br><span class="line">mongos&gt;<span class="keyword">use</span> admin</span><br><span class="line"><span class="keyword">db</span>.runCommand(&#123;<span class="string">"addshard"</span>:<span class="string">"10.139.8.207:27016"</span>&#125;)</span><br><span class="line"><span class="keyword">db</span>.runCommand(&#123;<span class="string">"addshard"</span>:<span class="string">"10.139.8.207:27017"</span>&#125;)</span><br><span class="line"></span><br><span class="line">设置分片数据库</span><br><span class="line">mongos&gt;<span class="keyword">use</span> admin</span><br><span class="line"><span class="keyword">db</span>.runCommand(&#123;<span class="string">"enablesharding"</span>: <span class="string">"oegw3"</span>&#125;) </span><br><span class="line">mongos&gt;<span class="keyword">use</span> oegw3;</span><br><span class="line">mongos&gt;<span class="keyword">db</span>.collectionName.ensureIndex(&#123;Date:1&#125;);</span><br><span class="line">mongos&gt;<span class="keyword">use</span> admin;</span><br><span class="line">mongos&gt;<span class="keyword">sh</span>.shardCollection(<span class="string">"oegw3.collectionName"</span>，&#123;Date:1&#125;);</span><br><span class="line"></span><br><span class="line">验证分片</span><br><span class="line"><span class="keyword">sh</span>.status();</span><br><span class="line"></span><br><span class="line">设置Balancer时间窗口</span><br><span class="line">查看均衡器在哪个机器则：</span><br><span class="line">mongos&gt;<span class="keyword">use</span> config</span><br><span class="line">mongos&gt;<span class="keyword">db</span>.locks.findOne(&#123;<span class="string">"_id"</span>:<span class="string">"balancer"</span>&#125;);</span><br><span class="line">启动均衡器</span><br><span class="line">mongos&gt;<span class="keyword">use</span> config</span><br><span class="line">mongos&gt;<span class="keyword">sh</span>.setBalancerState(true);</span><br><span class="line">或</span><br><span class="line">configsvr&gt;<span class="keyword">use</span> admin</span><br><span class="line">configsvr&gt;<span class="keyword">db</span>.settings.<span class="keyword">update</span>(&#123;_id:<span class="string">"balancer"</span>&#125;,&#123;<span class="variable">$set</span>:&#123;stopped:false&#125;&#125;,&#123;upsert:true&#125;)</span><br><span class="line"> </span><br><span class="line">关闭均衡器</span><br><span class="line">mongos&gt;<span class="keyword">sh</span>.setBalancerState(false);</span><br><span class="line">或</span><br><span class="line">mongos&gt;<span class="keyword">sh</span>.stopBalancer()</span><br><span class="line">或</span><br><span class="line">configsvr&gt;<span class="keyword">use</span> admin</span><br><span class="line">configsvr&gt;<span class="keyword">db</span>.settings.<span class="keyword">update</span>(&#123;_id:<span class="string">"balancer"</span>&#125;,&#123;<span class="variable">$set</span>:&#123;stopped:true&#125;&#125;,&#123;upsert:true&#125;);</span><br><span class="line"> </span><br><span class="line">设置时间窗口</span><br><span class="line">mongos&gt;<span class="keyword">db</span>.settings.<span class="keyword">update</span>(&#123;<span class="string">"_id"</span>:<span class="string">"balancer"</span>&#125;,&#123;<span class="variable">$set</span>:&#123;activeWindow:&#123;start:<span class="string">"23:00"</span>,stop:<span class="string">"8:00"</span>&#125;&#125;&#125;,true);</span><br><span class="line"></span><br><span class="line">均衡器只是用块的数量来，非数据的大小，作为衡量分片间是否均衡的指标。</span><br></pre></td></tr></table></figure>
<p>到这里Sharding也已经搭建完成了，以上只是最简单的搭建方式，其中某些配置仍然使用的是默认配置。如果设置不当，会导致效率异常低下，所以建议大家多看看官方文档再进行默认配置的修改。</p>
<p>####Sharding方式权限验证</p>
<p>登陆mongos添加用户</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]<span class="comment"># mongo 192.168.0.178:20000/admin</span></span><br><span class="line">MongoDB <span class="keyword">shell</span><span class="bash"> version: 2.6.1</span></span><br><span class="line"><span class="bash">connecting to: 192.168.0.178:20000/admin</span></span><br><span class="line"><span class="bash">mongos&gt; db</span></span><br><span class="line"><span class="bash">admin</span></span><br><span class="line"><span class="bash">mongos&gt; db.addUser(<span class="string">'admin'</span>,<span class="string">'allentuns'</span>)</span></span><br><span class="line"><span class="bash">WARNING: The <span class="string">'addUser'</span> shell helper is DEPRECATED. Please use <span class="string">'createUser'</span> instead</span></span><br><span class="line"><span class="bash">Successfully added user: &#123; <span class="string">"user"</span> : <span class="string">"admin"</span>, <span class="string">"roles"</span> : [ <span class="string">"root"</span> ] &#125;</span></span><br><span class="line"><span class="bash">mongos&gt; db.addUser(<span class="string">'admin_read'</span>,<span class="string">'allentuns_read'</span>，<span class="literal">true</span>)  <span class="comment">#添加超级管理员可读用户</span></span></span><br><span class="line"><span class="bash">WARNING: The <span class="string">'addUser'</span> shell helper is DEPRECATED. Please use <span class="string">'createUser'</span> instead</span></span><br><span class="line"><span class="bash">Successfully added user: &#123; <span class="string">"user"</span> : <span class="string">"admin_read"</span>, <span class="string">"roles"</span> : [ <span class="string">"read"</span> ] &#125;</span></span><br><span class="line"><span class="bash">mongos&gt; use uba</span></span><br><span class="line"><span class="bash">switched to db uba</span></span><br><span class="line"><span class="bash">mongos&gt; db.addUser(<span class="string">'sa'</span>,<span class="string">'123root'</span>)</span></span><br><span class="line"><span class="bash">WARNING: The <span class="string">'addUser'</span> shell helper is DEPRECATED. Please use <span class="string">'createUser'</span> instead</span></span><br><span class="line"><span class="bash">Successfully added user: &#123; <span class="string">"user"</span> : <span class="string">"sa"</span>, <span class="string">"roles"</span> : [ <span class="string">"dbOwner"</span> ] &#125;</span></span><br><span class="line"><span class="bash">mongos&gt; db.addUser(<span class="string">'sa_read'</span>,<span class="string">'123root_read'</span>,<span class="literal">true</span>)   <span class="comment">#添加uba管理员可读用户</span></span></span><br><span class="line"><span class="bash">WARNING: The <span class="string">'addUser'</span> shell helper is DEPRECATED. Please use <span class="string">'createUser'</span> instead</span></span><br><span class="line"><span class="bash">Successfully added user: &#123; <span class="string">"user"</span> : <span class="string">"sa_read"</span>, <span class="string">"roles"</span> : [ <span class="string">"read"</span> ] &#125;</span></span><br></pre></td></tr></table></figure>
<p>关闭服务器的mongod和mongos服务</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">killall mongos <span class="meta">&amp;&amp; killall mongod</span></span><br></pre></td></tr></table></figure>
<p>成keyfile：(每个进程的key file都保持一致)</p>
<figure class="highlight haskell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# openssl rand -base64 <span class="number">753</span> &gt;keyfile</span><br><span class="line">[root@master ~]# chmod <span class="number">600</span> keyfile #重点 必须</span><br><span class="line">[root@master ~]# cat keyfile </span><br><span class="line"><span class="number">4</span>a7w479ouV6fY5CASqxeWzzPhPLzZgYnHKWOFSIxjMABjaWK7up6Keb2+<span class="type">ZKz1C2R</span></span><br><span class="line"><span class="title">tfl7ukCBelW2xOL0h3gOSAdIhUi0j8IMBYZV</span>/kbUSSf0987xIur3lHZqUINPVVyl</span><br><span class="line"><span class="title">ib</span>+<span class="type">XPrg3SO4IG25tCQbEf</span>/twvS1CxiDmi/<span class="type">GtQZfqOjUX7MEJK3ynFBsB</span>/<span class="number">9</span>wU1nf1</span><br><span class="line"><span class="number">6</span>rLhBPIdmSnpNf5s9yGohx2wn6dQcJ8o0wn75oOBysX2mPkLI0tEu4//<span class="number">7</span>x1PgY9Q</span><br><span class="line"><span class="type">Ws4XdXs1MFqUYXkh8K6RFd</span>/<span class="type">TKB2zs5fonzqiXrgwpaW1KUFZB1lAfQwWePmxsWul</span></span><br><span class="line"><span class="type">HqR96</span>/yTGPxQKOVpm1Zdj2LGa616X3Www16Td4c2UVoM7mPi+<span class="type">Js8R2Flc6oV9H</span>+t</span><br><span class="line"><span class="title">eEDLMIVRDAAuQBNZl1reye0iaL8F0SgoELPiEm4A2La</span>+ovNrK6K+shV+jmvrOEIC</span><br><span class="line"><span class="number">6</span>KJly68ZX6x+<span class="type">Xd5qxfoREYKsrwMJJYY1tWesUE</span>+<span class="number">26</span>QUs4TJB17uQzc1wJaRQK0pz</span><br><span class="line"><span class="number">4</span>B3E4DFzJT72ybaGFpbP4v9gMfoXXc6pPWEJ1LMvhvv4vNl5vDSpbS3YNUQjaTcU</span><br><span class="line"><span class="title">juM2FlcUeKe3VFdqHkvdrhORv52gcrqnXco7UojOYmOHRpefXmL49XLlqw9FOJ2u</span></span><br><span class="line"><span class="title">giGKSs06OaK7kyiVayUT4fUR</span>+<span class="type">OXVOAAbPRgaNbDcI9P5knWkYwNdAwP</span>+jH9h73nI</span><br><span class="line"><span class="type">ZqdZ7SvDW0</span>/iT6zbPfeQubSYJw//<span class="type">NG5gfN5Rsd5oEpXXz8bFnuJSC1ltzJenTYYN</span></span><br><span class="line"><span class="number">0</span>vsS/<span class="number">8</span>EpUKhbLYjo5c93SBjopODBfA5pqQ9hRoL36l9SfWnUVgYaqpJgvKUmwb9P</span><br><span class="line"><span class="number">1</span>Bz1YCLRo1cU9skz+chhRnZWp2c2ElMfdMD/<span class="type">XpcAbgY1KToEJFAkTiNRHvgPYjiw</span></span><br><span class="line"><span class="title">eGgEBSXlMBlKDkNqmLZ6i</span>/<span class="type">C5fCWsqDEDrMPtBM4Pp9SOPjbkwpwYHxBCUPM7oyQT</span></span><br><span class="line"><span class="title">fCisA72oOBB5L4vO55soTzX</span>+jBBrOTBaJhdsEUMC0rEq</span><br><span class="line"></span><br><span class="line"><span class="meta">#将生成的keyfile 拷贝到mongod/mongos/config 进程对应的文件夹</span></span><br><span class="line">[root@master ~]# cp keyfile /<span class="class"><span class="keyword">data</span>/mongodb/config/<span class="keyword">data</span>/</span></span><br><span class="line">[root@master ~]# cp keyfile /<span class="class"><span class="keyword">data</span>/mongodb/mongos/</span></span><br><span class="line">[root@master ~]# cp keyfile /<span class="class"><span class="keyword">data</span>/mongodb/shard1/<span class="keyword">data</span>/</span></span><br><span class="line">[root@master ~]# cp keyfile /<span class="class"><span class="keyword">data</span>/mongodb/shard2/<span class="keyword">data</span>/</span></span><br><span class="line">[root@master ~]# cp keyfile /<span class="class"><span class="keyword">data</span>/mongodb/shard3/<span class="keyword">data</span>/</span></span><br><span class="line"></span><br><span class="line">然后通过scp的方式把这个文件分别拷贝到slave1和slave2机器的对应目录中</span><br><span class="line">验证slave1服务器的keyfile文件</span><br><span class="line">[root@slave1 ~]# find /<span class="class"><span class="keyword">data</span>/mongodb -name keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/shard2/<span class="keyword">data</span>/keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/shard1/<span class="keyword">data</span>/keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/shard3/<span class="keyword">data</span>/keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/config/<span class="keyword">data</span>/keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/mongos/keyfile</span></span><br><span class="line"></span><br><span class="line">验证slave2服务器的keyfile文件</span><br><span class="line">[root@slave2 ~]#  find /<span class="class"><span class="keyword">data</span>/mongodb -name keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/shard2/<span class="keyword">data</span>/keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/shard1/<span class="keyword">data</span>/keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/shard3/<span class="keyword">data</span>/keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/config/<span class="keyword">data</span>/keyfile</span></span><br><span class="line">/<span class="class"><span class="keyword">data</span>/mongodb/mongos/keyfile</span></span><br></pre></td></tr></table></figure>
<p>使用–keyFile参数指定前面生成的keyfile文件，重启机器全部mongod,mongos进程</p>
<p>1、分别在master、slave1和slave2服务器上启动配置服务器</p>
<p>mongod –configsvr –dbpath /data/mongodb/config/data –port 21000 –logpath /data/mongodb/config/log/config.log –fork –keyFile /data/mongodb/config/data/keyfile</p>
<p>#注意在这个过程中，会报错，只需要再次执行chmod 600 /data/mongodb/config/data/keyfile 就可以</p>
<p>2、分别在master、slave1和slave2服务器上启动mongos服务器</p>
<p>mongos  –configdb 192.168.0.178:21000,192.168.0.180:21000,192.168.0.181:21000 –port 20000  –keyFile /data/mongodb/mongos/keyfile –logpath  /data/mongodb/mongos/log/mongos.log –fork</p>
<p>#执行chmod 600 /data/mongodb/mongos/keyfile</p>
<p>3、分别在master、slave1和slave2服务器上配置分片副本集</p>
<p>mongod –shardsvr –replSet shard1 –port 22001 –keyFile /data/mongodb/shard1/data/keyfile –dbpath /data/mongodb/shard1/data  –logpath /data/mongodb/shard1/log/shard1.log –fork –nojournal  –oplogSize 10</p>
<p>mongod –shardsvr –replSet shard2 –port 22002 –keyFile /data/mongodb/shard2/data/keyfile –dbpath /data/mongodb/shard2/data  –logpath /data/mongodb/shard1/log/shard2.log –fork –nojournal  –oplogSize 10</p>
<p>mongod –shardsvr –replSet shard3 –port 22003 –keyFile /data/mongodb/shard3/data/keyfile –dbpath /data/mongodb/shard3/data  –logpath /data/mongodb/shard1/log/shard3.log –fork –nojournal  –oplogSize 10</p>
<p>chmod 600 /data/mongodb/shard1/data/keyfile</p>
<p>chmod 600 /data/mongodb/shard2/data/keyfile</p>
<p>chmod 600 /data/mongodb/shard3/data/keyfile</p>
<p>验证认证</p>
<p>需要认证，没有认证没有任何权限</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">[root@master ~]# mongo localhost:20000</span><br><span class="line">MongoDB shell version: 2.6.1</span><br><span class="line">connecting <span class="keyword">to</span>: localhost:20000/test</span><br><span class="line"><span class="builtin-name">Error</span> <span class="keyword">while</span> trying <span class="keyword">to</span> show<span class="built_in"> server </span>startup warnings: <span class="keyword">not</span> authorized on admin <span class="keyword">to</span> execute command &#123; getLog: <span class="string">"startupWarnings"</span> &#125;</span><br><span class="line">mongos&gt; show collections;</span><br><span class="line">2014-08-03T12:02:48.535+0800 error: &#123;</span><br><span class="line">	<span class="string">"<span class="variable">$err</span>"</span> : <span class="string">"not authorized for query on test.system.namespaces"</span>,</span><br><span class="line">	<span class="string">"code"</span> : 13</span><br><span class="line">&#125; at src/mongo/shell/query.js:131</span><br><span class="line">mongos&gt; use uba</span><br><span class="line">switched <span class="keyword">to</span> db uba</span><br><span class="line">mongos&gt; db</span><br><span class="line">uba</span><br><span class="line">mongos&gt; show collections;</span><br><span class="line">2014-08-03T12:03:10.923+0800 error: &#123; <span class="string">"<span class="variable">$err</span>"</span> : <span class="string">"not authorized for query on uba.system.namespaces"</span>, <span class="string">"code"</span> : 13 &#125; at src/mongo/shell/query.js:131</span><br></pre></td></tr></table></figure>
<p>账户认证后状态</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line">#admin库认证</span><br><span class="line">[root@master ~]# mongo localhost:20000/admin -<span class="keyword">u</span> admin -p allentuns</span><br><span class="line">MongoDB <span class="keyword">shell</span> <span class="keyword">version</span>: 2.6.1</span><br><span class="line">connecting to: localhost:20000/admin</span><br><span class="line">mongos&gt; show collections;</span><br><span class="line">system.indexes</span><br><span class="line">system.users</span><br><span class="line">system.<span class="keyword">version</span></span><br><span class="line">#uba库认证 读写权限用户</span><br><span class="line">[root@master ~]# mongo localhost:20000/uba -<span class="keyword">u</span> <span class="keyword">sa</span> -p 123root</span><br><span class="line">MongoDB <span class="keyword">shell</span> <span class="keyword">version</span>: 2.6.1</span><br><span class="line">connecting to: localhost:20000/uba</span><br><span class="line"><span class="keyword">Error</span> <span class="keyword">while</span> trying to show server startup warnings: not authorized <span class="keyword">on</span> admin to execute command &#123; getLog: <span class="string">"startupWarnings"</span> &#125;</span><br><span class="line">mongos&gt; show collections;</span><br><span class="line">system.indexes</span><br><span class="line">table1</span><br><span class="line">mongos&gt; <span class="keyword">db</span>.table1.<span class="keyword">count</span>()</span><br><span class="line">0</span><br><span class="line">mongos&gt; <span class="keyword">for</span> (<span class="keyword">var</span> i = 1; i &lt;= 1000; i++)<span class="keyword">db</span>.table1.<span class="keyword">save</span>(&#123;id:i,name:<span class="string">"username"</span>+i,age:i&#125;);</span><br><span class="line">WriteResult(&#123; <span class="string">"nInserted"</span> : 1 &#125;)</span><br><span class="line">mongos&gt; <span class="keyword">db</span>.table1.<span class="keyword">count</span>()</span><br><span class="line">1000</span><br><span class="line">mongos&gt; <span class="keyword">db</span>.table1.findOne()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"_id"</span> : ObjectId(<span class="string">"53ddb52a65bb900f61e458a1"</span>),</span><br><span class="line">	<span class="string">"id"</span> : 1,</span><br><span class="line">	<span class="string">"name"</span> : <span class="string">"username1"</span>,</span><br><span class="line">	<span class="string">"age"</span> : 1</span><br><span class="line">&#125;</span><br><span class="line">mongos&gt; <span class="keyword">db</span>.auth('<span class="keyword">sa</span>','123root')</span><br><span class="line">1</span><br><span class="line"></span><br><span class="line">#uba库 只读权限用户</span><br><span class="line">[root@master ~]# mongo localhost:20000/uba -<span class="keyword">u</span> sa_read -p 123root_read</span><br><span class="line">MongoDB <span class="keyword">shell</span> <span class="keyword">version</span>: 2.6.1</span><br><span class="line">connecting to: localhost:20000/uba</span><br><span class="line"><span class="keyword">Error</span> <span class="keyword">while</span> trying to show server startup warnings: not authorized <span class="keyword">on</span> admin to execute command &#123; getLog: <span class="string">"startupWarnings"</span> &#125;</span><br><span class="line">mongos&gt; <span class="keyword">db</span>.auth('sa_read','123root_read')</span><br><span class="line">1</span><br><span class="line">mongos&gt; <span class="keyword">db</span></span><br><span class="line">uba</span><br><span class="line">mongos&gt; <span class="keyword">for</span> (<span class="keyword">var</span> i = 1; i &lt;= 1000; i++)<span class="keyword">db</span>.table1.<span class="keyword">save</span>(&#123;id:i,name:<span class="string">"username"</span>+i,age:i&#125;);</span><br><span class="line">WriteResult(&#123;</span><br><span class="line">	<span class="string">"writeError"</span> : &#123;</span><br><span class="line">		<span class="string">"code"</span> : 13,</span><br><span class="line">		<span class="string">"errmsg"</span> : <span class="string">"not authorized on uba to execute command &#123; insert: \"</span>table1\<span class="string">", documents: [ &#123; id: 1000.0, name: \"</span>username1000\<span class="string">", age: 1000.0, _id: ObjectId('53ddb5d62390d9a487087c87') &#125; ], ordered: true &#125;"</span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;)</span><br><span class="line">mongos&gt; <span class="keyword">db</span>.table1.findOne()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="string">"_id"</span> : ObjectId(<span class="string">"53ddb52a65bb900f61e458a1"</span>),</span><br><span class="line">	<span class="string">"id"</span> : 1,</span><br><span class="line">	<span class="string">"name"</span> : <span class="string">"username1"</span>,</span><br><span class="line">	<span class="string">"age"</span> : 1</span><br><span class="line">&#125;</span><br><span class="line">mongos&gt; <span class="keyword">db</span>.table1.<span class="keyword">count</span>()</span><br><span class="line">1000</span><br></pre></td></tr></table></figure>
<p>验证主从切换，现在在192.168.0.180 slave1集群上停掉22001端口的服务，看master是否能接替slave1主的工作</p>
<figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">[root@slave1 ~]# netstat -tnlp |grep mongo</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">22001</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">1955</span>/mongod         </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">22002</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">2019</span>/mongod         </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">22003</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">2081</span>/mongod         </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">20000</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">1870</span>/mongos         </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">21000</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">1847</span>/mongod         </span><br><span class="line">[root@slave1 ~]# kill <span class="number">1955</span></span><br><span class="line">[root@slave1 ~]# netstat -tnlp |grep mongo</span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">22002</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">2019</span>/mongod         </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">22003</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">2081</span>/mongod         </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">20000</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">1870</span>/mongos         </span><br><span class="line">tcp        <span class="number">0</span>      <span class="number">0</span> <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:<span class="number">21000</span>               <span class="number">0.0</span><span class="meta">.0</span><span class="meta">.0</span>:*                   LISTEN      <span class="number">1847</span>/mongod    </span><br><span class="line">[root@slave1 ~]# mongo <span class="number">192.168</span><span class="meta">.0</span><span class="meta">.178</span>:<span class="number">22001</span>/admin</span><br><span class="line">MongoDB shell version: <span class="number">2.6</span><span class="meta">.1</span></span><br><span class="line">connecting to: <span class="number">192.168</span><span class="meta">.0</span><span class="meta">.178</span>:<span class="number">22001</span>/admin</span><br><span class="line">Welcome to the MongoDB shell.</span><br><span class="line">For interactive help, type <span class="string">"help"</span>.</span><br><span class="line">For more comprehensive documentation, see</span><br><span class="line"><span class="symbol">	http:</span>//docs.mongodb.org/</span><br><span class="line">Questions? Try the support group</span><br><span class="line"><span class="symbol">	http:</span>//groups.google.com/group/mongodb-user</span><br><span class="line">Error while trying to show server startup warnings: <span class="keyword">not</span> authorized on admin to execute command &#123; getLog: <span class="string">"startupWarnings"</span> &#125;</span><br><span class="line"><span class="symbol">shard1:</span>PRIMARY&gt; ^C</span><br><span class="line">bye</span><br><span class="line">[root@slave1 ~]# mongo <span class="number">192.168</span><span class="meta">.0</span><span class="meta">.178</span>:<span class="number">22002</span>/admin</span><br><span class="line">MongoDB shell version: <span class="number">2.6</span><span class="meta">.1</span></span><br><span class="line">connecting to: <span class="number">192.168</span><span class="meta">.0</span><span class="meta">.178</span>:<span class="number">22002</span>/admin</span><br><span class="line">Error while trying to show server startup warnings: <span class="keyword">not</span> authorized on admin to execute command &#123; getLog: <span class="string">"startupWarnings"</span> &#125;</span><br><span class="line"><span class="symbol">shard2:</span>ARBITER&gt; ^C</span><br><span class="line">bye</span><br><span class="line">[root@slave1 ~]# mongod --shardsvr --replSet shard1 --port <span class="number">22001</span> --keyFile /data/mongodb/shard1/data/keyfile --dbpath /data/mongodb/shard1/data  --logpath /data/mongodb/shard1/log/shard1.log --fork --nojournal  --oplogSize <span class="number">10</span></span><br><span class="line">about to fork child process, waiting until server is ready for connections.</span><br><span class="line">forked process: <span class="number">2641</span></span><br><span class="line">child process started successfully, parent exiting</span><br><span class="line">[root@slave1 ~]# mongo <span class="number">192.168</span><span class="meta">.0</span><span class="meta">.180</span>:<span class="number">22001</span>/admin</span><br><span class="line">MongoDB shell version: <span class="number">2.6</span><span class="meta">.1</span></span><br><span class="line">connecting to: <span class="number">192.168</span><span class="meta">.0</span><span class="meta">.180</span>:<span class="number">22001</span>/admin</span><br><span class="line">Error while trying to show server startup warnings: <span class="keyword">not</span> authorized on admin to execute command &#123; getLog: <span class="string">"startupWarnings"</span> &#125;</span><br><span class="line"><span class="symbol">shard1:</span>SECONDARY&gt;</span><br></pre></td></tr></table></figure></div><div class="tags"></div><div class="post-nav"><a class="pre" href="/2017/05/11/mongodb/004 mongodb-deploy-practice/">004 部署Sharding（包含Replica Set）实践</a><a class="next" href="/2017/05/11/mongodb/002 mongodb-Replica Set install/">002 mongodb集群方式Replica Set的搭建</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/docker/">docker</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/maven/">maven</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/mongodb/">mongodb</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/springMvc/">springMvc</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/springboot/">springboot</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/springcloud/">springcloud</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/杂记/">杂记</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/hexo/" style="font-size: 15px;">hexo</a> <a href="/tags/docker/" style="font-size: 15px;">docker</a> <a href="/tags/部署/" style="font-size: 15px;">部署</a> <a href="/tags/es/" style="font-size: 15px;">es</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/linux/" style="font-size: 15px;">linux</a> <a href="/tags/定时任务/" style="font-size: 15px;">定时任务</a> <a href="/tags/工具类/" style="font-size: 15px;">工具类</a> <a href="/tags/tomcat/" style="font-size: 15px;">tomcat</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/07/02/docker/docker-compose install tools/">docker-compose 安装工具</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/02/docker/docker cmd/">docker 基础命令</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/07/02/docker/install docker/">docker/docker-compose安装</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/11/other/docker in out/">docker 简单操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/03/11/other/elastic search dump/">es 简单操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/29/other/linux operator/">linux常规操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2019/01/24/other/git operator/">git操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/26/springboot/sharding jdbc/">springboot2.0.6使用sharding jdbc3.0</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/11/23/springboot/tip-springboot tip/">springboot一些方法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/08/docker/docker install tools/">docker安装工具</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul></ul><a href="http://www.example1.com/" title="site-name1" target="_blank">site-name1</a><ul></ul><a href="http://www.example2.com/" title="site-name2" target="_blank">site-name2</a><ul></ul><a href="http://www.example3.com/" title="site-name3" target="_blank">site-name3</a></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">雨中风筝.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.2/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>